<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase æœƒå“¡ç™»å…¥</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* --- ç«‹æ³•é™¢ä¸»é¡Œè‰²å®šç¾© --- */
        :root {
            --color-primary-dark: #1a237e; /* ä¸»æ·±è—è‰² */
            --color-primary-light: #004d99; /* è¼ƒäº®çš„è—è‰² */
            --color-accent: #ffcc00; /* å¼·èª¿é»ƒè‰²/é‡‘è‰² */
            --color-success: #4CAF50;
            --color-error: #f44336;
        }

        /* --- åŸºç¤æ’ç‰ˆ --- */
        body {
            font-family: "Noto Sans TC", "Arial", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--color-primary-dark); /* æ·±è—è‰²èƒŒæ™¯ */
        }
        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* æ›´æ·±çš„é™°å½± */
            width: 100%;
            max-width: 420px;
            text-align: center;
            border-top: 5px solid var(--color-accent); /* é ‚éƒ¨é»ƒè‰²è£é£¾ç·š */
        }
        h2 {
            color: var(--color-primary-dark);
            margin-bottom: 30px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        h2 i {
            color: var(--color-accent);
            margin-right: 10px;
        }

        /* --- è¡¨å–®è¼¸å…¥ --- */
        input[type="email"], input[type="password"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        input[type="email"]:focus, input[type="password"]:focus {
            border-color: var(--color-primary-light);
            outline: none;
        }

        /* --- æŒ‰éˆ• --- */
        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
        }
        #loginBtn { 
            background-color: var(--color-primary-dark); 
            color: white; 
        }
        #loginBtn:hover {
            background-color: var(--color-primary-light);
            transform: translateY(-1px);
        }
        
        /* ç‹€æ…‹è¨Šæ¯ */
        #status {
            margin-top: 25px;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
            border: 1px solid transparent;
        }
        /* æˆåŠŸç‹€æ…‹ */
        #status[style*="ddf"] {
            background-color: #e6f7e6; /* æ·ºç¶ è‰² */
            color: var(--color-success);
            border-color: #c9e6c9;
        }
        /* éŒ¯èª¤ç‹€æ…‹ */
        #status[style*="fdd"] {
            background-color: #ffe6e6; /* æ·ºç´…è‰² */
            color: var(--color-error);
            border-color: #e6c9c9;
        }

        /* éš±è—å…ƒç´  */
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2><i class="fas fa-lock"></i> æœƒå“¡ç™»å…¥</h2>

        <div id="authArea">
            <input type="email" id="emailInput" placeholder="é›»å­éƒµä»¶" required>
            <input type="password" id="passwordInput" placeholder="å¯†ç¢¼" required>
            
            <button id="loginBtn">ç™»å…¥ç³»çµ±</button>
        </div>

        <div id="profileArea" class="hidden">
            <p><strong>ç™»å…¥æˆåŠŸï¼Œæ­£åœ¨å°å‘è‡³ç§äººé é¢...</strong></p>
        </div>

        <div id="status">è«‹è¼¸å…¥æ‚¨çš„æœƒå“¡æ†‘è­‰ã€‚</div>

    </div>

    <script>
    // ğŸš¨ æ­¥é©Ÿ 1: é…ç½®æ‚¨çš„ Firebase è¨­å®š ğŸš¨
    const firebaseConfig = {
        apiKey: "AIzaSyACnoimIASfb1rb59SbgLDkUmyYR6ODbUU",
        authDomain: "llwb-ed686.firebaseapp.com",
        projectId: "llwb-ed686",
        storageBucket: "llwb-ed686.firebasestorage.app",
        messagingSenderId: "940345852074",
        appId: "1:940345852074:web:7a30cca5a6d997a92350d3",
        measurementId: "G-KWL4ZE3D18"
    };
    
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // âœ… PRIVATE_PAGE_URL è®Šæ•¸å¿…é ˆæ˜¯æ­£ç¢ºçš„ Firebase Hosting ç¶²å€
    const PRIVATE_PAGE_URL = 'https://llwb-ed686.web.app/private.html'; 

    // ç²å– DOM å…ƒç´ 
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginBtn = document.getElementById('loginBtn');
    const statusDiv = document.getElementById('status');

    function updateStatus(message, isError = false) {
        statusDiv.textContent = message;
        statusDiv.style.backgroundColor = isError ? '#fdd' : '#ddf';
    }

    // --- ç™»å…¥è™•ç†å‡½æ•¸ ---
    loginBtn.addEventListener('click', () => {
        const email = emailInput.value;
        const password = passwordInput.value;

        if (!email || !password) {
            updateStatus("è«‹è¼¸å…¥é›»å­éƒµä»¶å’Œå¯†ç¢¼ã€‚", true);
            return;
        }
        
        // æ¸…é™¤ä¸Šä¸€æ¬¡çš„éŒ¯èª¤/æˆåŠŸè¨Šæ¯
        updateStatus("æ­£åœ¨é©—è­‰æ†‘è­‰...");

        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                // æˆåŠŸç™»å…¥å¾Œï¼Œç‹€æ…‹ç›£è½å™¨ (onAuthStateChanged) å°‡æœƒè§¸ç™¼é‡å®šå‘
                updateStatus("ç™»å…¥æˆåŠŸï¼Œæ­£åœ¨é‡å®šå‘...");
            })
            .catch((error) => {
                let errorMessage = `ç™»å…¥å¤±æ•—: ${error.message}`;
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    errorMessage = "ç™»å…¥å¤±æ•—: å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ã€‚";
                }
                updateStatus(errorMessage, true);
            });
    });

    // ğŸ’¡ é—œéµé‚è¼¯: ç›£è½ä½¿ç”¨è€…ç‹€æ…‹è®ŠåŒ–ä¸¦åŸ·è¡Œé‡å®šå‘ ğŸ’¡
    auth.onAuthStateChanged((user) => {
        if (user) {
            // ä½¿ç”¨è€…å·²ç™»å…¥

            // æª¢æŸ¥ç›®å‰æ˜¯å¦åœ¨ç™»å…¥é é¢ (login.html æˆ– root index)
            if (window.location.pathname.endsWith('login.html') || window.location.pathname.endsWith('index.html') || window.location.pathname.endsWith('/')) {
                
                // âœ… åŸ·è¡Œè·³è½‰æŒ‡ä»¤
                window.location.href = PRIVATE_PAGE_URL;
            }
        } else {
            // ä½¿ç”¨è€…å·²ç™»å‡º (æˆ–æœªç™»å…¥)
            
            // æª¢æŸ¥ç›®å‰æ˜¯å¦åœ¨ç§äººé é¢ (å®‰å…¨ç¶²ï¼šé˜²æ­¢ä½¿ç”¨è€…ç›´æ¥è¨ªå•ç§äººé é¢)
            if (window.location.href.includes(PRIVATE_PAGE_URL)) { 
                // å¦‚æœåœ¨ç§äººé é¢ï¼Œä½†æœªç™»å…¥ï¼Œå‰‡å°å› login.html 
                window.location.href = 'login.html'; 
            }
        }
    });
    </script>
</body>
</html>
